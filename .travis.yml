language: python
python:
  - "3.8"

sudo: false

git:
  submodules: false

before_install:
  - sed -i 's/git@github.com:/https:\/\/github.com\//' .gitmodules
  - git submodule update --init --recursive

install:
  - curl -sL https://deb.nodesource.com/setup_11.x | sudo -E bash -
  - sudo apt-get install -y nodejs
  - pip install -r ./package-ffs/requirements.txt
  - pip install -U platformio

script:
  - ./make && ./package

deploy:
  provider: releases
  prerelease: true
  api_key: ${GH_TOKEN}
  file_glob: true
  file: target/*
  skip_cleanup: true
  on:
    tags: true
    branch: master
